<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Login — Prestige Motors</title>
		<meta name="description" content="Login to access the Prestige Motors admin dashboard." />
		<link rel="stylesheet" href="/css/styles.css" />
		<script defer src="/js/scripts.js"></script>
		<style>
			body{font-family:Inter, system-ui, Arial, sans-serif;color:var(--dark);margin:0;line-height:1.45;display:flex;align-items:center;justify-content:center;min-height:100vh;background:var(--bg)}
			header{display:flex;align-items:center;justify-content:space-between;padding:22px 36px;border-bottom:1px solid var(--border);position:absolute;top:0;left:0;right:0;background:var(--card)}
			.logo{display:flex;gap:14px;align-items:center}
			.logo img{height:48px}
			nav{display:flex;flex-direction:row;align-items:center;gap:8px}
			.nav-item{border-radius:999px;border:1px solid var(--border);background:var(--card);padding:0}
			.nav-item a{display:block;padding:8px 12px;color:var(--muted);font-weight:500;text-decoration:none}
			.nav-item a:hover{color:var(--dark)}
			.nav-item a.active{color:var(--accent);font-weight:600}
			.container{max-width:1200px;margin:0 auto}
			.login-container{max-width:420px;width:100%;padding:40px;background:var(--card);border-radius:12px;border:1px solid var(--border);box-shadow:0 4px 12px rgba(0,0,0,0.08)}
			.login-container h1{margin:0 0 8px;font-size:1.8rem}
			.login-container p{color:var(--muted);margin:0 0 24px}
			form{display:flex;flex-direction:column;gap:16px}
			label{font-size:0.95rem;color:var(--dark);font-weight:500}
			input{padding:12px;border-radius:6px;border:1px solid var(--border);background:var(--card);outline:none;font-size:0.95rem;color:var(--dark);width:100%}
			input:focus{box-shadow:0 0 0 4px rgba(191,160,107,0.12);border-color:var(--accent-600)}
			button{background:var(--accent);color:white;padding:12px 18px;border-radius:6px;border:0;cursor:pointer;font-weight:600;font-size:1rem}
			button:hover{background:var(--accent-600)}
			button:disabled{opacity:0.6;cursor:not-allowed}
			.error-message{color:#dc2626;background:#fee2e2;padding:12px;border-radius:6px;margin-bottom:16px;display:none}
			.success-message{color:#059669;background:#d1fae5;padding:12px;border-radius:6px;margin-bottom:16px;display:none}
			.back-link{margin-top:16px;text-align:center}
			.back-link a{color:var(--accent);text-decoration:none;font-weight:500}
		</style>
	</head>
	<body>
		<!-- Header -->
		<header class="container">
			<div class="logo">
				<a href="/pages/home.html">
					<img src="https://images.unsplash.com/photo-1617531653332-bd46c24f2068?w=200&h=200&fit=crop&auto=format" alt="Prestige Motors logo" />
				</a>
				<div>
					<div style="font-weight:700">Prestige Motors</div>
					<div style="font-size:12px;color:var(--muted)">Luxury • Semi‑Luxury • Select Pre‑Owned</div>
				</div>
			</div>
			<nav aria-label="Primary navigation">
				<div class="nav-item"><a href="/pages/home.html">Home</a></div>
				<div class="nav-item"><a href="/pages/inventory.html">Inventory</a></div>
				<div class="nav-item"><a href="/pages/finance-tradein.html">Finance & Trade‑In</a></div>
				<div class="nav-item"><a href="/pages/about.html">About</a></div>
				<div class="nav-item"><a href="/pages/contact.html">Contact</a></div>
			</nav>
			<!-- Header controls: theme toggle etc. -->
			<div class="header-controls" aria-hidden="false">
				<button id="theme-toggle" aria-pressed="false" aria-label="Toggle dark mode">☀️</button>
			</div>
		</header>

		<!-- Login Form -->
		<main style="width:100%;padding:120px 20px 40px">
			<div class="login-container">
				<h1>Admin Login</h1>
				<p>Sign in to access the dealer dashboard and manage inventory.</p>
				
				<div id="error-message" class="error-message"></div>
				<div id="success-message" class="success-message"></div>
				
				<form id="login-form" aria-label="Login form">
					<label>
						Username
						<input name="username" type="text" placeholder="Enter your username" required autocomplete="username" />
					</label>
					<label>
						Password
						<input name="password" type="password" placeholder="Enter your password" required autocomplete="current-password" />
					</label>
					<button type="submit" id="login-button">Sign In</button>
				</form>
				
				<div class="back-link">
					<a href="/pages/home.html">← Back to website</a>
				</div>
			</div>
		</main>

		<script>
			// Check if already logged in
			if (localStorage.getItem('authToken')) {
				window.location.href = '/pages/showroom.html'
			}

			// Handle login form submission
			document.getElementById('login-form').addEventListener('submit', async (e) => {
				e.preventDefault()
				
				const form = e.target
				const username = form.username.value.trim()
				const password = form.password.value.trim()
				const loginButton = document.getElementById('login-button')
				const errorDiv = document.getElementById('error-message')
				const successDiv = document.getElementById('success-message')
				
				// Hide previous messages
				errorDiv.style.display = 'none'
				successDiv.style.display = 'none'
				
				// Disable button
				loginButton.disabled = true
				loginButton.textContent = 'Signing in...'
				
				try {
					const response = await fetch('/api/login', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify({ username, password })
					})
					
					// Check if response is ok before parsing JSON
					let data
					try {
						data = await response.json()
					} catch (parseError) {
						console.error('Failed to parse response:', parseError)
						errorDiv.textContent = 'Server error: Invalid response. Please check if the server is running.'
						errorDiv.style.display = 'block'
						loginButton.disabled = false
						loginButton.textContent = 'Sign In'
						return
					}
					
					if (response.ok && data.success) {
						// Store auth token
						localStorage.setItem('authToken', data.token)
						localStorage.setItem('username', data.username)
						
						// Show success message
						successDiv.textContent = 'Login successful! Redirecting...'
						successDiv.style.display = 'block'
						
						// Redirect to showroom
						setTimeout(() => {
							window.location.href = '/pages/showroom.html'
						}, 500)
					} else {
						// Show error
						errorDiv.textContent = data.message || 'Invalid username or password'
						errorDiv.style.display = 'block'
						loginButton.disabled = false
						loginButton.textContent = 'Sign In'
					}
				} catch (error) {
					console.error('Login error:', error)
					let errorMsg = 'An error occurred. Please try again.'
					if (error.message) {
						errorMsg += ' Error: ' + error.message
					}
					if (error.name === 'TypeError' && error.message.includes('fetch')) {
						errorMsg = 'Cannot connect to server. Please make sure the server is running on http://localhost:3000'
					}
					errorDiv.textContent = errorMsg
					errorDiv.style.display = 'block'
					loginButton.disabled = false
					loginButton.textContent = 'Sign In'
				}
			})
		</script>
	</body>
</html>

